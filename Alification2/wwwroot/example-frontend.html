<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Web App Example</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Room Booking App</h1>
    
    <script>
        // Telegram Web App SDK automatically provides initData
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Get initData that Telegram provides automatically
        const initData = tg.initData || tg.initDataUnsafe;
        
        // Create API client that automatically sends initData
        async function apiCall(endpoint, options = {}) {
            const headers = {
                'Content-Type': 'application/json',
                'X-Telegram-Init-Data': initData,  // Send initData in header
                ...options.headers
            };

            const response = await fetch(`/api${endpoint}`, {
                ...options,
                headers
            });

            if (!response.ok) {
                throw new Error(`API error: ${response.status}`);
            }

            return response.json();
        }

        // Example: Get current user
        async function loadUser() {
            try {
                const user = await apiCall('/me');
                console.log('User:', user);
                document.body.innerHTML += `<p>User: ${user.hasAccount ? 'Logged in' : 'Not registered'}</p>`;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Call API when page loads
        loadUser();

        // Example: Create company
        async function createCompany() {
            const result = await apiCall('/companies', {
                method: 'POST',
                body: JSON.stringify({
                    name: 'My Company',
                    password: 'secret123',
                    userName: 'John Doe'
                })
            });
            console.log('Company created:', result);
        }
    </script>
</body>
</html>

